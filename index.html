<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Omikuji</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="script.js"></script>
    <script>
     AFRAME.registerComponent("scntrl", {
        init: function () {
          this.el.addEventListener("click", function (e) {
            let btm = document.querySelector('#button_mute');
            if(muteFlag){  //ミュート中
                btm.setAttribute("src","#unmute_btn");
                UnMute();
            }
            else{  //ミュート解除中
                btm.setAttribute("src","#mute_btn");
                Mute();
            }
            muteFlag = !muteFlag
          });
        },
      });
    </script>
</head>
<body>
    <a-scene id="scene" environment="preset:japan;ground:flat" xr-mode-ui="enabled: false">
        <!--アセットの読み込み-->
        <a-assets>
            <a-asset-itemid id="uma" src="./assets/omikujiUma.glb"></a-asset-item>
            <a-asset-item id="omikujibox" src="./assets/omikuji.glb"></a-asset-item>
            <a-asset-item id="honden" src="./assets/honden.glb"></a-asset-item>
            <a-asset-item id="kadomatsu" src="./assets/kadomatsu.glb"></a-asset-item>
            <audio id="sea" src="./assets/SpringSea.mp3" preload="auto"></audio>
            <audio id="push" src="./assets/PushButton.mp3" preload="auto"></audio>
            <audio id="run" src="./assets/RunHorse.mp3" preload="auto"></audio>
            <audio id="disp" src="./assets/Disp.mp3" preload="auto"></audio>
            <audio id="shuffle" src="./assets/Shuffle.mp3" preload="auto"></audio>
            <audio id="move" src="./assets/Move.mp3" preload="auto"></audio>
            <img id="daikichi" src="./assets/o_daikichi.png" crossorigin="anonymous"></img>
            <img id="chuukichi" src="./assets/o_chuukichi.png" crossorigin="anonymous"></img>
            <img id="syoukichi" src="./assets/o_syoukichi.png" crossorigin="anonymous"></img>
            <img id="kichi" src="./assets/o_kichi.png" crossorigin="anonymous"></img>
            <img id="suekichi" src="./assets/o_suekichi.png" crossorigin="anonymous"></img>
            <img id="kyou" src="./assets/o_kyou.png" crossorigin="anonymous"></img>
            <img id="daikyou" src="./assets/o_daikyou.png" crossorigin="anonymous"></img>
            <img id="niko" src="./assets/niko.png" crossorigin="anonymous"></img>
            <img id="oko" src="./assets/oko.png" crossorigin="anonymous"></img>
            <img id="bk_btn" src="./assets/button_Black.png" crossorigin="anonymous"></img>
            <img id="pk_btn" src="./assets/button_Pink.png" crossorigin="anonymous"></img>
            <img id="mute_btn" src="./assets/mute.png" crossorigin="anonymous"></img>
            <img id="unmute_btn" src="./assets/muteOff.png" crossorigin="anonymous"></img>
            <img id="finish_btn" src="./assets/button_Finish.png" crossorigin="anonymous"></img>
        </a-assets>
        <a-sound id="s_sea" position="3 3 -1" sound="src: #sea; autoplay: false; loop:true" volume="0"></a-sound>
        <a-entity camera id="camera" position="3 3 0">
            <a-entity cursor="rayOrigin: mouse;fuse:false"></a-entity>
            <a-image id="omikuji" position="-0.04 0.5 -5" scale="3.2 6 1" visible="false"></a-image>
            <a-sound id="s_disp" sound="src: #disp; autoplay: false; loop:false" volume="0"></a-sound>
            <a-entity id="mascot" animation-mixer gltf-model="#uma" position="0 -3 -30" scale="1 1 1" visible="false"></a-entity>
            <a-sound id="s_run" sound="src: #run; autoplay: false; loop:false" volume="0"></a-sound>
            <a-entity id="box" gltf-model="#omikujibox" position="0 -0.5 -5" scale="0.7 0.7 0.7" visible="true"></a-entity>
            <a-sound id="s_shuffle" sound="src: #shuffle; autoplay: false; loop:false" volume="0"></a-sound>
            <a-sound id="s_move" sound="src: #move; autoplay: false; loop:false" volume="0"></a-sound>
            <a-entity gltf-model="#honden" position="0 -3 -30" scale="0.7 0.7 0.7"></a-entity>
            <a-entity gltf-model="#kadomatsu" position="-6 0 -15" rotation="0 30 0" scale="0.5 0.5 0.5"></a-entity>
            <a-entity gltf-model="#kadomatsu" position="6 0 -15" rotation="0 -30 0" scale="0.5 0.5 0.5"></a-entity>
            <a-image src="#niko" position="-1.3 -1.3 -3.5" scale="0.5 0.85 0.5"></a-image>
            <a-image src="#oko" position="1.3 -1.3 -3.5" scale="0.5 0.85 0.5"></a-image>
            <a-image id="button_bk" src="#bk_btn" position="-0.3 -1.3 -2" height="0.3" width="0.8" visible="true"></a-image>
            <a-sound id="s_push" sound="src: #push; autoplay: false; loop:false" volume="0"></a-sound>
            <a-image id="button_pk" src="#pk_btn" position="-0.3 -1.3 -2" height="0.3" width="0.8" visible="false"></a-image>
            <a-image id="button_fin" src="#finish_btn" position="0.32 -1.285 -2" height="0.3" width="0.4" visible="true"></a-image>
            <a-image id="button_mute" scntrl src="#mute_btn" position="0.7 -1.3 -2" height="0.3" width="0.3"></a-image>
        </a-entity>           
    </a-scene>
</body>
<script>
   let btb = document.querySelector('#button_bk');
   let btp = document.querySelector('#button_pk');
   let sdisp = document.querySelector('#s_disp');
   let btm = document.querySelector('#button_mute');
   let fin = document.querySelector('#button_fin');
   btb.addEventListener('click', () => {    
      if(!btb.getAttribute("visible")) return;  
      if (sdisp.components.sound.isPlaying) {
          sdisp.components.sound.stopSound();
      }
      document.querySelector("#s_push").components.sound.playSound();
      btb.setAttribute("visible", "false");
      btp.setAttribute("visible", "true");
      setTimeout(() => {
        btp.setAttribute("visible", "false"); //ボタンを消す
        FortuneSlip()
      },200);       
  });
  fin.addEventListener('click', () => {    
    window.close();
  });
</script>
</html>

